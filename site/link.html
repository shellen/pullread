<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Open in Pull Read</title>
<meta name="description" content="Open this article in Pull Read, the local-first article reader for macOS.">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://pullread.com/link">
<meta property="og:title" content="Open in Pull Read">
<meta property="og:description" content="Open this article in Pull Read, the local-first article reader for macOS.">
<meta property="og:image" content="https://pullread.com/og-image.png">
<meta property="og:site_name" content="Pull Read">

<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="icon" href="/favicon-192.png" type="image/png" sizes="192x192">
<link rel="icon" href="/favicon.ico" sizes="48x48">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/shared.css">
<style>
  /* Card */
  .link-page {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 100px 20px 60px;
  }

  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .link-card {
    max-width: 480px;
    width: 100%;
    background: var(--card);
    border-radius: 16px;
    border: 1px solid var(--border);
    padding: 40px;
    text-align: center;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  }

  .link-card .icon {
    margin-bottom: 20px;
  }

  .link-card h1 {
    font-size: 20px;
    font-weight: 700;
    letter-spacing: -0.02em;
    margin-bottom: 8px;
  }

  .link-card .status {
    color: var(--ink-muted);
    font-size: 15px;
    margin-bottom: 24px;
  }

  .link-card .article-title {
    font-size: 14px;
    font-weight: 500;
    color: var(--ink-secondary);
    margin-bottom: 4px;
    word-break: break-word;
  }

  .link-card .article-url {
    font-size: 13px;
    color: var(--ink-muted);
    word-break: break-all;
    margin-bottom: 24px;
  }

  .link-card .article-url a {
    color: var(--ink-muted);
    text-decoration: none;
  }

  .link-card .article-url a:hover {
    color: var(--accent);
  }

  .link-card .actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .link-card .actions a {
    width: 100%;
    justify-content: center;
  }

  .spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2.5px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-bottom: 16px;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .hidden { display: none; }

  .btn-ghost {
    background: transparent;
    color: var(--ink-muted);
    padding: 10px 18px;
  }

  .btn-ghost:hover {
    color: var(--ink);
    background: rgba(0,0,0,0.04);
  }

  @media (max-width: 640px) {
    .link-card { padding: 32px 24px; }
  }
</style>
</head>
<body>

<a href="#main-content" class="skip-link">Skip to content</a>
<nav aria-label="Main navigation">
  <a href="/" class="nav-brand">
    <div class="nav-logo">
      <svg fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>
    </div>
    <span class="nav-wordmark">Pull Read</span>
  </a>
  <ul class="nav-links" role="list">
    <li class="hide-m"><a href="/#features">Features</a></li>
    <li class="hide-m"><a href="/#intelligence">Intelligence</a></li>
    <li class="hide-m"><a href="/releases.html">Releases</a></li>
    <li class="hide-m"><a href="/faq.html">FAQ</a></li>
    <li><a href="https://github.com/shellen/pullread/releases/download/latest/PullRead.dmg" class="btn btn-accent btn-sm">
      <svg class="dl-icon" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 16 16"><path d="M8 2v9M4.5 7.5 8 11l3.5-3.5M2.5 13.5h11"/></svg>
      Download
    </a></li>
  </ul>
</nav>

<main class="link-page" id="main-content">
  <div class="link-card">
    <!-- Loading state: shown while attempting deep link -->
    <div id="loading-state">
      <div class="spinner"></div>
      <h1>Opening in Pull Read&hellip;</h1>
      <p class="status">Trying to open this article in the app.</p>
    </div>

    <!-- Fallback state: shown if app doesn't respond -->
    <div id="fallback-state" class="hidden">
      <div class="icon">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <rect x="4" y="4" width="40" height="40" rx="10" fill="#b45535"/>
          <g transform="translate(12, 12)">
            <path fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/>
          </g>
        </svg>
      </div>
      <h1>Read this in Pull Read</h1>
      <p class="status">Save, highlight, and annotate articles locally on your Mac.</p>
      <div id="article-info"></div>
      <div class="actions">
        <a id="try-open" href="#" class="btn btn-dark">Open in Pull Read</a>
        <a id="source-link" href="#" class="btn btn-ghost">View original article</a>
        <a href="https://github.com/shellen/pullread/releases/download/latest/PullRead.dmg" class="btn btn-ghost">Download Pull Read</a>
      </div>
    </div>

    <!-- No URL state: shown if link params are missing -->
    <div id="no-url-state" class="hidden">
      <div class="icon">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <rect x="4" y="4" width="40" height="40" rx="10" fill="#b45535"/>
          <g transform="translate(12, 12)">
            <path fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/>
          </g>
        </svg>
      </div>
      <h1>Pull Read</h1>
      <p class="status">This link is missing an article URL. It may have been shared incorrectly.</p>
      <div class="actions">
        <a href="/" class="btn btn-dark">Visit pullread.com</a>
      </div>
    </div>
  </div>
</main>

<footer aria-label="Site footer">
  <div class="f-left">
    <a href="https://alittledrive.com" style="font-weight:600;">A Little Drive</a>
    <span style="color:var(--ink-faint)">Â·</span>
    <span>Made by <a href="https://shellen.com">Jason Shellen</a></span>
  </div>
  <ul class="f-links" role="list" aria-label="Footer links">
    <li><a href="/privacy.html">Privacy</a></li>
    <li><a href="/terms.html">Terms</a></li>
    <li><a href="/releases.html">Releases</a></li>
    <li><a href="/faq.html">FAQ</a></li>
    <li><a href="/press.html">Press</a></li>
  </ul>
</footer>

<script>
(function() {
  var params = new URLSearchParams(window.location.search);
  var url = params.get('url');
  var title = params.get('title') || '';

  if (!url) {
    document.getElementById('loading-state').classList.add('hidden');
    document.getElementById('no-url-state').classList.remove('hidden');
    return;
  }

  // Build the deep link
  var deepLink = 'pullread://save?url=' + encodeURIComponent(url);
  if (title) deepLink += '&title=' + encodeURIComponent(title);

  // Attempt the deep link via hidden iframe (avoids navigation if app isn't installed)
  var iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  iframe.src = deepLink;
  document.body.appendChild(iframe);

  // Set up the fallback state
  var infoEl = document.getElementById('article-info');
  if (title) {
    infoEl.innerHTML = '<p class="article-title">' + escapeHtml(title) + '</p>' +
      '<p class="article-url"><a href="' + escapeHtml(url) + '">' + escapeHtml(truncateUrl(url)) + '</a></p>';
  } else {
    infoEl.innerHTML = '<p class="article-url"><a href="' + escapeHtml(url) + '">' + escapeHtml(truncateUrl(url)) + '</a></p>';
  }

  document.getElementById('try-open').href = deepLink;
  document.getElementById('source-link').href = url;

  // After 2.5 seconds, show fallback (app either opened or isn't installed)
  setTimeout(function() {
    document.getElementById('loading-state').classList.add('hidden');
    document.getElementById('fallback-state').classList.remove('hidden');
  }, 2500);

  function escapeHtml(str) {
    var div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  function truncateUrl(u) {
    try {
      var parsed = new URL(u);
      var display = parsed.hostname + parsed.pathname;
      return display.length > 60 ? display.substring(0, 57) + '...' : display;
    } catch(e) {
      return u.length > 60 ? u.substring(0, 57) + '...' : u;
    }
  }
})();
</script>
<script src="/download-gate.js"></script>

</body>
</html>
