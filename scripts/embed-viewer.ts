// ABOUTME: Pre-build script that embeds viewer.html into a TypeScript module
// ABOUTME: Eliminates runtime file-path resolution for the viewer HTML

import { readFileSync, writeFileSync } from 'fs';
import { join, dirname } from 'path';

const rootDir = join(dirname(process.argv[1]), '..');
const htmlPath = join(rootDir, 'viewer.html');
const outPath = join(rootDir, 'src', 'viewer-html.ts');

const html = readFileSync(htmlPath, 'utf-8');

// JSON.stringify safely escapes all special characters (quotes, newlines,
// backslashes, unicode, angle brackets, template literals, etc.)
const source = [
  '// Auto-generated by scripts/embed-viewer.ts â€” do not edit',
  '// Source: viewer.html',
  `export const VIEWER_HTML = ${JSON.stringify(html)};`,
  '',
].join('\n');

writeFileSync(outPath, source);
console.log(`Embedded viewer.html (${html.length} bytes) into src/viewer-html.ts`);
